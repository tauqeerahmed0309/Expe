<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget & Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --text-dark: #1e293b;
            --text-light: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 1rem;
        }

        .app-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 1100px;
            padding: 2.5rem;
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 2.5rem;
        }

        /* --- LEFT COLUMN --- */
        .left-column { display: flex; flex-direction: column; gap: 1.5rem; }

        header h1 { font-size: 1.8rem; color: var(--text-dark); font-weight: 700; }
        header p { color: var(--text-light); font-size: 0.9rem; }

        /* BUDGET SECTION (NEW) */
        .budget-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .budget-header h3 { font-size: 1rem; color: var(--text-dark); font-weight: 600; }
        
        .budget-input-group { display: flex; gap: 0.5rem; }
        .budget-input-group input {
            padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 8px; width: 100px; font-size: 0.9rem;
        }
        .set-btn {
            background: var(--text-dark); color: white; border: none; padding: 0.5rem 0.8rem;
            border-radius: 8px; cursor: pointer; font-size: 0.8rem;
        }

        /* Progress Bar */
        .progress-container {
            height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden; margin: 1rem 0 0.5rem 0;
        }
        .progress-fill {
            height: 100%; width: 0%; background: var(--success); transition: width 0.5s ease, background 0.3s;
        }

        .budget-info { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-light); }
        .budget-info strong { color: var(--text-dark); }
        
        .remaining-text { font-size: 0.9rem; font-weight: 600; margin-top: 0.5rem; text-align: right; }
        .remaining-text.danger { color: var(--danger); }
        .remaining-text.safe { color: var(--success); }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .stat-card {
            padding: 1.5rem; border-radius: 16px; color: white; position: relative; overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .stat-card.balance { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .stat-card.spending { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }
        .stat-card h3 { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; margin-bottom: 0.5rem; }
        .stat-card .value { font-size: 1.5rem; font-weight: 700; }
        .stat-card .subtext { font-size: 0.8rem; opacity: 0.8; margin-top: 0.2rem; }
        .stat-card i { position: absolute; right: 15px; top: 15px; font-size: 3rem; opacity: 0.2; }

        /* Form */
        .add-box {
            background: white; padding: 1.5rem; border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0;
        }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; font-size: 0.85rem; font-weight: 500; color: var(--text-dark); margin-bottom: 0.5rem; }
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-light); }
        
        input.form-input {
            width: 100%; padding: 0.8rem 1rem 0.8rem 2.8rem; border: 2px solid #f1f5f9;
            border-radius: 12px; font-size: 0.95rem; outline: none; transition: 0.3s;
        }
        input.form-input:focus { border-color: var(--primary); background: #f8fafc; }

        button#add-btn {
            width: 100%; padding: 0.9rem; background: var(--text-dark); color: white;
            border: none; border-radius: 12px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: 0.2s;
        }
        button#add-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.15); }

        /* --- RIGHT COLUMN --- */
        .right-column { display: flex; flex-direction: column; gap: 1.5rem; }
        .chart-container {
            background: white; padding: 1.5rem; border-radius: 16px; height: 260px;
            position: relative; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0;
        }

        .history-header h2 { font-size: 1.2rem; color: var(--text-dark); margin-bottom: 1rem; }
        .expense-list { list-style: none; display: flex; flex-direction: column; gap: 0.8rem; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .expense-list::-webkit-scrollbar { width: 6px; }
        .expense-list::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }

        .expense-item {
            background: white; padding: 1rem; border-radius: 12px; display: flex;
            justify-content: space-between; align-items: center; border: 1px solid #f1f5f9;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .item-left { display: flex; align-items: center; gap: 1rem; }
        .icon-box {
            width: 40px; height: 40px; background: #e0e7ff; color: var(--primary);
            border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }
        .details h4 { font-size: 1rem; color: var(--text-dark); font-weight: 600; }
        .details p { font-size: 0.75rem; color: var(--text-light); }
        .price { font-weight: 700; color: var(--text-dark); font-size: 1rem; }
        
        .delete-btn {
            background: none; border: none; color: #ef4444; cursor: pointer;
            margin-left: 10px; font-size: 1rem; opacity: 0.6; transition: 0.2s;
        }
        .delete-btn:hover { opacity: 1; transform: scale(1.1); }

        /* Responsive */
        @media (max-width: 900px) {
            .app-container { grid-template-columns: 1fr; padding: 1.5rem; }
            .chart-container { height: 220px; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="left-column">
            <header>
                <h1><i class="fa-solid fa-wallet"></i> My Expenses</h1>
                <p>Track spending & manage budget</p>
            </header>

            <div class="budget-card">
                <div class="budget-header">
                    <h3>Monthly Budget</h3>
                    <div class="budget-input-group">
                        <input type="number" id="budget-input" placeholder="Set Limit">
                        <button class="set-btn" onclick="setBudget()">Set</button>
                    </div>
                </div>
                
                <div class="budget-info">
                    <span>Spent: <strong id="total-spent-display">₹0</strong></span>
                    <span>Limit: <strong id="budget-limit-display">₹0</strong></span>
                </div>

                <div class="progress-container">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>

                <div class="remaining-text safe" id="remaining-display">
                    Remaining: ₹0
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card balance">
                    <h3>Total Spent</h3>
                    <div class="value" id="total-amount">₹0.00</div>
                    <i class="fa-solid fa-indian-rupee-sign"></i>
                </div>
                <div class="stat-card spending">
                    <h3>Top Expense</h3>
                    <div class="value" id="highest-expense-name">-</div>
                    <div class="subtext" id="highest-expense-amount">₹0.00</div>
                    <i class="fa-solid fa-fire"></i>
                </div>
            </div>

            <div class="add-box">
                <form id="expense-form">
                    <div class="input-group">
                        <label>Expense Name</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-tag"></i>
                            <input type="text" class="form-input" id="expense-name" placeholder="Netflix, Groceries..." required autocomplete="off">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Amount</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-indian-rupee-sign"></i>
                            <input type="number" class="form-input" id="expense-amount" placeholder="0.00" min="0.01" step="0.01" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Date</label>
                        <div class="input-wrapper">
                            <i class="fa-regular fa-calendar"></i>
                            <input type="date" class="form-input" id="expense-date" required>
                        </div>
                    </div>
                    <button type="submit" id="add-btn"><i class="fa-solid fa-plus"></i> Add Transaction</button>
                </form>
            </div>
        </div>

        <div class="right-column">
            <div class="chart-container">
                <canvas id="expenseChart"></canvas>
            </div>

            <div>
                <div class="history-header">
                    <h2>Transaction History</h2>
                </div>
                <ul id="expense-list" class="expense-list"></ul>
            </div>
        </div>

    </div>

    <script>
        // --- DATA STATE ---
        let expenses = [];
        let totalBudget = 0;
        let myChart = null;

        // --- DOM ELEMENTS ---
        const form = document.getElementById('expense-form');
        const listContainer = document.getElementById('expense-list');
        const totalAmountEl = document.getElementById('total-amount');
        const highestNameEl = document.getElementById('highest-expense-name');
        const highestAmountEl = document.getElementById('highest-expense-amount');
        const dateInput = document.getElementById('expense-date');
        
        // Budget Elements
        const budgetInput = document.getElementById('budget-input');
        const budgetLimitDisplay = document.getElementById('budget-limit-display');
        const totalSpentDisplay = document.getElementById('total-spent-display');
        const progressBar = document.getElementById('progress-bar');
        const remainingDisplay = document.getElementById('remaining-display');

        // Set default date
        dateInput.valueAsDate = new Date();

        // --- EVENT LISTENERS ---
        form.addEventListener('submit', addExpense);

        // --- BUDGET FUNCTION ---
        function setBudget() {
            const val = parseFloat(budgetInput.value);
            if (isNaN(val) || val < 0) {
                alert("Please enter a valid budget amount");
                return;
            }
            totalBudget = val;
            budgetInput.value = ''; // clear input
            updateUI(); // Recalculate everything
        }

        // --- CORE FUNCTIONS ---
        function addExpense(e) {
            e.preventDefault();
            const name = document.getElementById('expense-name').value.trim();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;

            if (name === '' || isNaN(amount) || amount <= 0) return;

            const expense = { id: Date.now(), name: name, amount: amount, date: date };
            expenses.push(expense);
            updateUI();
            form.reset();
            dateInput.valueAsDate = new Date();
        }

        function deleteExpense(id) {
            expenses = expenses.filter(expense => expense.id !== id);
            updateUI();
        }

        function updateUI() {
            renderList();
            updateSummary(); // This now also handles the Budget UI
            updateChart();
        }

        function renderList() {
            listContainer.innerHTML = '';
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedExpenses.length === 0) {
                listContainer.innerHTML = '<div style="text-align:center; color: var(--text-light); padding: 20px;">No transactions yet</div>';
                return;
            }

            sortedExpenses.forEach(expense => {
                const li = document.createElement('li');
                li.classList.add('expense-item');
                li.innerHTML = `
                    <div class="item-left">
                        <div class="icon-box"><i class="fa-solid fa-bag-shopping"></i></div>
                        <div class="details">
                            <h4>${escapeHtml(expense.name)}</h4>
                            <p>${formatDate(expense.date)}</p>
                        </div>
                    </div>
                    <div class="item-right">
                        <div class="price">₹${expense.amount.toFixed(2)}</div>
                        <button class="delete-btn" onclick="deleteExpense(${expense.id})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
                listContainer.appendChild(li);
            });
        }

        function updateSummary() {
            // 1. Calculate Total Spent
            const total = expenses.reduce((sum, item) => sum + item.amount, 0);
            
            // 2. Update Basic Stats
            totalAmountEl.innerText = formatCurrency(total);
            
            // 3. Update Budget UI
            updateBudgetUI(total);

            // 4. Update Highest Expense
            if (expenses.length === 0) {
                highestNameEl.innerText = '-';
                highestAmountEl.innerText = '₹0.00';
                return;
            }

            const spendingMap = {};
            expenses.forEach(item => {
                spendingMap[item.name] = (spendingMap[item.name] || 0) + item.amount;
            });

            let maxName = '';
            let maxVal = 0;
            for (const [name, val] of Object.entries(spendingMap)) {
                if (val > maxVal) { maxVal = val; maxName = name; }
            }
            highestNameEl.innerText = maxName;
            highestAmountEl.innerText = formatCurrency(maxVal);
        }

        function updateBudgetUI(totalSpent) {
            // Display Texts
            budgetLimitDisplay.innerText = formatCurrency(totalBudget);
            totalSpentDisplay.innerText = formatCurrency(totalSpent);

            if (totalBudget === 0) {
                // If no budget set, keep bar empty
                progressBar.style.width = '0%';
                remainingDisplay.innerText = 'Set a budget to track savings';
                remainingDisplay.className = 'remaining-text';
                return;
            }

            const remaining = totalBudget - totalSpent;
            const percentage = (totalSpent / totalBudget) * 100;

            // Update Progress Bar Width
            progressBar.style.width = `${Math.min(percentage, 100)}%`;

            // Update Colors based on percentage
            if (percentage >= 100) {
                progressBar.style.background = '#ef4444'; // Red
                remainingDisplay.className = 'remaining-text danger';
                remainingDisplay.innerText = `Over Budget by ${formatCurrency(Math.abs(remaining))}`;
            } else if (percentage >= 75) {
                progressBar.style.background = '#f59e0b'; // Orange
                remainingDisplay.className = 'remaining-text';
                remainingDisplay.innerText = `Remaining: ${formatCurrency(remaining)}`;
            } else {
                progressBar.style.background = '#10b981'; // Green
                remainingDisplay.className = 'remaining-text safe';
                remainingDisplay.innerText = `Remaining: ${formatCurrency(remaining)}`;
            }
        }

        function updateChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            const spendingMap = {};
            expenses.forEach(item => {
                spendingMap[item.name] = (spendingMap[item.name] || 0) + item.amount;
            });
            const labels = Object.keys(spendingMap);
            const data = Object.values(spendingMap);

            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#4f46e5', '#ec4899', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { font: { family: 'Poppins' }, boxWidth: 12 } },
                    },
                    cutout: '75%'
                }
            });
        }

        // --- Helpers ---
        function formatCurrency(num) {
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);
        }
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-IN', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','-':'&quot;',"'":'&#039;'}[m]));
        }

        updateChart();
    </script>
</body>
</html>
